---
title: 搭建博客评论系统
date: 2021-10-29 16:13:12
permalink: /comment/1
categories:
  - 轮子使用
  - VuePress
tags: 
  - 插件
---



::: warning

这个插件只针对GitHub，不是Gitee。如果有类似的插件，可以参考下面流程，万变不离其宗。

:::

## 前言

如果需要个人博客搭建搭建评论区，可以使用 [vuepress-plugin-comment](https://github.com/dongyuanxin/vuepress-plugin-comment)进行搭建。它帮助我们把Gitalk应用到静态博客。

Gitalk是一个基于 Github Issue 和 Preact 开发的评论插件。所以你需要创建一个GitHub库，利用该库的issues存储评论信息

如果你已经有一个GitHub的仓库存储你的博客文件。那么可以直接使用该库的issues存储评论信息。毕竟分类就是把关联的东西放在一起，更好管理。

建议先把自己的博客部署到Github Actions下，不然本地运行的话，评论区只能自己评论，自己看哦~~~ :smile_cat:[部署传送门](/deploy)

下面让我们一起搭建评论区吧。

## 安装

<code-group>
  <code-block title="YARN" active>
  ```sh
  yarn add vuepress-plugin-comment -D
  ```
  </code-block>

  <code-block title="NPM">
  ```sh
  npm install vuepress-plugin-comment -D
  ```
  </code-block>
</code-group>



## 使用

插件需要**GitHub Application**，即权限。如果没有，[点击这里申请](https://github.com/settings/applications/new)

如图：

![image-20211029170149380](https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/%E5%85%B3%E4%BA%8E%E5%8D%9A%E5%AE%A2/20211029170449.png)

::: details 参数说明

- Application name：你授权时对外的应用名字
- Homepage URL：你应用的根`url`地址，类似于首页地址，不带任何参数
- Application description：应用的描述
- Authorization callback URL：对你的应用进行了操作后的回调地址，因为评论区绑定了博客，评论后的信息存储在博客的issues里

:::

申请完成就会得 Client ID 和 Client Secret

![image-20211029170446147](https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/%E5%85%B3%E4%BA%8E%E5%8D%9A%E5%AE%A2/20211029170726.png)

前往配置文件，填入你的两个参数和其他信息，如下：

```js
module.exports = {
  plugins: [
    [
      'vuepress-plugin-comment',
      {
        choosen: 'gitalk', 
        options: {
          clientID: 'c042********01c7',  // 你的client ID
          clientSecret: 'b77b38cf72**********45d0a0',  // 你的client secret
           repo: 'notes-blog', // GitHub 仓库
            owner: 'Kele-Bingtang', // GitHub仓库所有者
            admin: ['Kele-Bingtang'], // 对仓库有写权限的人
            // distractionFreeMode: true,
            pagerDirection: 'last', // 'first'正序 | 'last'倒序
            // 下面的不用修改，默认这些即可
            id: '<%- (frontmatter.permalink || frontmatter.to.path).slice(-16) %>', //  页面的唯一标识,长度不能超过50
            title: '「评论」<%- frontmatter.title %>', // GitHub issue 的标题
            labels: ['Gitalk', 'Comment'], // GitHub issue 的标签
            body:
              '页面：<%- window.location.origin + (frontmatter.to.path || window.location.pathname) %>', // GitHub issue 的内容
        }
      }
    ]
  ]
}
```

配置好后，重启项目，然后打开某个文档，滑到最下方

可以看到

![image-20211029171306537](https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/%E5%85%B3%E4%BA%8E%E5%8D%9A%E5%AE%A2/20211029171308.png)

点击<mark>使用 GitHub 登录</mark>，然后会要求授权，确定后评论功能实现啦

## 问题

1. **评论区出现 Error: Validation Failed.**

分析：可能页面的链接过长，超过50，请求Issues失败。所以手动设置id取值，限制长度不超过50

2. **切换页面后评论区内容还是上一个页面的评论**

分析：`frontmatter.to.path`没有即时获取`path`

两个问题的解决：

```js
{
 choosen: 'gitalk', 
 options: {
   ...
   id: "<%- (window.location.origin + (frontmatter.to.path || window.location.pathname)).slice(-50) %>", //  页面的唯一标识,长度不能超过50
   title: "「评论」<%- document.title %>", // GitHub issue 的标题
   labels: ["Gitalk", "Comment"], // GitHub issue 的标签
   body:"<%- document.title %>：<%- window.location.origin + (frontmatter.to.path || window.location.pathname) %>" // GitHub issue 的内容
 }
}
```

::: note

其实上方代码在前面的参数配置时，已经加上，这里只是演示问题

:::

3. **点击<mark>使用 GitHub 登录</mark>，跳转别的页面**

    ![image-20211029171306537](https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/%E5%85%B3%E4%BA%8E%E5%8D%9A%E5%AE%A2/20211029171308.png)

分析：申请**GitHub Application**时候，填错了`Authorization callback URL`地址，点击<mark>使用 GitHub 登录</mark>其实就是跳转到`Authorization callback URL`的填写地址。

解决:`Authorization callback URL`地址填好自己的博客链接

